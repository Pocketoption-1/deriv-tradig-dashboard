<!DOCTYPE html>
<html>
<head>
  <title>Deriv Trading Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    label, select, input, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    #status {
      margin-top: 20px;
      padding: 10px;
      border-radius: 5px;
    }
    #login {
      background: #FF4444;
      margin-bottom: 20px;
    }
    #login:hover {
      background: #CC0000;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <button id="login">Login with Deriv</button>
  
  <div id="dashboard" class="hidden">
    <h2>Deriv Trading Dashboard</h2>
    <label for="symbol">Select Asset:</label>
    <select id="symbol">
      <option value="R_100">Volatility 100</option>
      <option value="1HZ100V">1Hz Volatility 100</option>
    </select>

    <label for="amount">Amount (USD):</label>
    <input type="number" id="amount" placeholder="e.g., 1" min="0.35" step="0.01">

    <label for="contract_type">Contract Type:</label>
    <select id="contract_type">
      <option value="CALL">Rise</option>
      <option value="PUT">Fall</option>
    </select>

    <button id="trade">Place Trade</button>
    <p id="status"></p>
  </div>

  <script>
    // OAuth Login
    document.getElementById("login").onclick = () => {
      const app_id = "76088"; // Your App ID
      window.location.href = `https://oauth.deriv.com/oauth2/authorize?app_id=${app_id}&l=en&brand=deriv`;
    };

    // Handle OAuth redirect
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");

    if (token) {
      // Hide login button, show dashboard
      document.getElementById("login").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      
      // Initialize WebSocket
      const ws = new WebSocket('wss://ws.deriv.com/websockets/v3');
      
      ws.onopen = () => {
        ws.send(JSON.stringify({ authorize: token }));
        document.getElementById("status").textContent = "Connecting to Deriv API...";
      };

      ws.onmessage = (msg) => {
        const data = JSON.parse(msg.data);
        if (data.msg_type === "authorize") {
          document.getElementById("status").textContent = `Connected as ${data.authorize.loginid}`;
        }
        if (data.msg_type === "buy") {
          document.getElementById("status").textContent = `Trade placed! ID: ${data.buy.transaction_id}`;
        }
        if (data.error) {
          document.getElementById("status").textContent = `Error: ${data.error.message}`;
        }
      };

      ws.onerror = (error) => {
        document.getElementById("status").textContent = `WebSocket error: ${error.message}`;
      };

      // Trading function
      document.getElementById("trade").onclick = () => {
        const symbol = document.getElementById("symbol").value;
        const amount = parseFloat(document.getElementById("amount").value);
        const contract_type = document.getElementById("contract_type").value;

        if (!amount || amount < 0.35) {
          document.getElementById("status").textContent = "Minimum amount is $0.35";
          return;
        }

        const payload = {
          buy: 1,
          price: amount,
          parameters: {
            amount,
            basis: "stake",
            contract_type,
            currency: "USD",
            duration: 1,
            duration_unit: "t",
            symbol
          }
        };
        ws.send(JSON.stringify(payload));
      };
    } else {
      document.getElementById("status").textContent = "Please login first";
    }
  </script>
</body>
</html>